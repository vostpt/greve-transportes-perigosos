!function(e){var o={};function t(a){if(o[a])return o[a].exports;var r=o[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)t.d(a,r,function(o){return e[o]}.bind(null,r));return a},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="/",t(t.s=1)}({1:function(e,o,t){e.exports=t("mUkR")},mUkR:function(e,o){var t=[],a=[],r=['Thanks to <a href="https://www.facebook.com/WazePortugal/">Waze Portugal</a> for providing important data and permission to use their services','This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy">Privacy Policy</a> and <a href="https://policies.google.com/terms">Terms of Service</a> apply'],i={obj:null},s={obj:null},l=["gasoline","diesel","lpg","none","without_gasoline","without_diesel","without_lpg"],n=["normal","sos","none"],p=["Bxpress","Ecobrent","OZ Energia","Prio","Tfuel","Outros"],d=!0;mapboxgl.accessToken="pk.eyJ1Ijoidm9zdHB0IiwiYSI6ImNqeXR3aHQxdTAyYjgzY21wbDMwaHJoaDQifQ.ql-IskzjOdAtEFvbltquaw";var c=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-7.8536599,39.557191],zoom:6,attributionControl:!1});String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})};var u=null,g=null,m=!1;function v(){return new Promise(function(e,o){t=[],$.getJSON("/storage/data/cache.json",function(o){o.forEach(function(e){e.repa="";var o=0,a=0,r=0,i=0,s=0,l=0,n=0,d="",c="",u="",g=0,m=e.brand,v="",f=0,b=0;e.sell_gasoline&&(b++,e.has_gasoline?(o=1,f++):s=1),e.sell_diesel&&(b++,e.has_diesel?(a=1,f++):l=1),e.sell_lpg&&(b++,e.has_lpg?(r=1,f++):n=1),"SOS"==e.repa||"Normal"==e.repa?("SOS"==e.repa?(e.repa="sos",g=2,c="0070bb",u="e6e6e6",m+=" (REPA - Veículos Prioritários)",g=2,v="<strong>Posto REPA - Prioritários</strong>"):"Normal"==e.repa&&(e.repa="normal",g=1,c="0070bb",u="e6e6e6",m+=" (REPA - Todos os Veículos)",g=1,v="<strong>Posto REPA - Geral</strong>"),d=f==b?"REPA":0==f?"REPA_NONE":"REPA_PARTIAL"):(v="",f==b?(d="ALL",c="006837",u="e6e6e6"):0==f?(d="NONE",c="c1272c",u="e6e6e6"):(d="PARTIAL",c="f7921e",u="e6e6e6")),f==b?v+='<p style="margin-bottom:0">Disponível</p>':0==f?(v+='<p style="margin-bottom:0">Não Disponível</p>',i=1):v+='<p style="margin-bottom:0">Parcialmente Disponível</p>',"POSTO ES"==e.brand?(d="SPAIN",v="<strong>Posto Espanhol</strong>"):v+='<p style="margin-bottom:0">Marca: '+e.brand+"</p>";var h=new Date(e.updated_at.replace(/ /,"T")+"+00:00"),_=function(e){var o=Math.floor((new Date-e)/1e3),t=Math.floor(o/86400),a=Math.floor(o%86400/3600),r=Math.min(59,Math.ceil(o%3600/60)),i="";return(i||t>0)&&(i+=" "+t+"d"),(i||a>0)&&(i+=" "+a+"h"),(i||r>0)&&(i+=" "+r+"m"),i.trim()}(h),S=h.toLocaleString();v+='<p style="margin-bottom:0">ID: '+e.id+"</p>",v+='<p style="margin-bottom:0">Atualizado há '+_+"</p>",v+='<p style="margin-bottom:0">Atualizado em '+S+"</p>",t.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lat,e.long]},properties:{id:e.id,name:e.name,brand:m,brand_management:e.brand_management,repa:e.repa,with_gasoline:o,with_diesel:a,with_lpg:r,without_gasoline:s,without_diesel:l,without_lpg:n,with_none:i,sell_gasoline:e.sell_gasoline,sell_diesel:e.sell_diesel,sell_lpg:e.sell_lpg,has_gasoline:e.has_gasoline,has_diesel:e.has_diesel,has_lpg:e.has_lpg,icon:d,popup_color:c,background_color:u,priority:g,tooltip:v,brand_layer:p.includes(e.brand)?e.brand:"Outros"}})}),e()})})}function f(e,o){return new Promise(function(t,a){c.loadImage(o,function(o,r){o?(console.log("ERROR:"+o),a(o)):(console.log("IMAGE LOADED"),c.addImage(e,r),t())})})}function b(){var e=new Date,o=e.getSeconds(),t=e.getMinutes(),a=e.getHours(),i=[].concat(r);return i.push("Última atualização às: "+("0"+a).slice(-2)+"h"+("0"+t).slice(-2)+"m"+("0"+o).slice(-2)+"s"),i}function h(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.push(v()),Promise.all(a).then(function(){a=[],e||(n.forEach(function(e){l.forEach(function(o){p.forEach(function(t){var a="poi-"+e+"-"+o+"-"+t;c.removeLayer(a)})})}),c.removeSource("points")),c.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:t}}),n.forEach(function(o){var t=o;"none"==t&&(t=""),l.forEach(function(a){p.forEach(function(r){var i="poi-"+o+"-"+a+"-"+r;c.addLayer({id:i,type:"symbol",source:"points",layout:{"icon-image":"{icon}","symbol-sort-key":["get","priority"],"icon-allow-overlap":!0}}),-1==a.indexOf("without")?c.setFilter(i,["all",["==","with_"+a,1],["==","repa",t],["==","brand_layer",r]]):c.setFilter(i,["all",["==",a,1],["==","repa",t],["==","brand_layer",r]]),e&&function(e){c.on("click",e,function(e){var o=e.features[0].geometry.coordinates.slice(),t=e.features[0].properties.sell_gasoline&&e.features[0].properties.has_gasoline?'<img data-toggle="tooltip" title="Com Gasolina" src="/img/map/VOSTPT_FUELCRISIS_GASOLINA_500pxX500px.png"/>':'<img data-toggle="tooltip" title="Sem Gasolina" class="no-gas"src="/img/map/VOSTPT_FUELCRISIS_GASOLINA_500pxX500px.png"/>',a=e.features[0].properties.sell_diesel&&e.features[0].properties.has_diesel?'<img data-toggle="tooltip" title="Com Gasóleo" src="/img/map/VOSTPT_FUELCRISIS_GASOLEO_500pxX500px.png"/>':'<img data-toggle="tooltip" title="Sem Gasóleo" class="no-gas" src="/img/map/VOSTPT_FUELCRISIS_GASOLEO_500pxX500px.png"/>',r=e.features[0].properties.sell_lpg&&e.features[0].properties.has_lpg?'<img data-toggle="tooltip" title="Com GPL" width="75px" src="/img/map/VOSTPT_FUELCRISIS_GPL_500pxX500px.png"/>':'<img data-toggle="tooltip" title="Sem GPL" class="no-gas" src="/img/map/VOSTPT_FUELCRISIS_GPL_500pxX500px.png"/>',i=e.features[0].properties.name?e.features[0].properties.name.toUpperCase():"",s="",l="";if(isHelping())l="",e.features[0].properties.sell_gasoline&&(l+='<div class="col-md v-fuel-info gasoline"><a href="#" onclick="swapIcon(this)">'+t+"</a><h6>GASOLINA</h6></div>"),e.features[0].properties.sell_diesel&&(l+='<div class="col-md v-fuel-info diesel"><a href="#" onclick="swapIcon(this)">'+a+"</a><h6>GASÓLEO</h6></div>"),e.features[0].properties.sell_lpg&&(l+='<div class="col-md v-fuel-info lpg"><a href="#" onclick="swapIcon(this)">'+r+"</a><h6>GPL</h6></div>"),s='<div class="v-popup-content"><div class="v-popup-header" style="background-color:#85d5f8; text-align: center;"><h5>ADICIONAR INFORMAÇÃO</h5></div><div class="v-popup-body" style="background-color:#b8e1f8"><div class="row">'+l+'</div><img src="/img/map/separation.png" style="width: calc(100% + 1.6em); margin-left:-0.8em;" />',"Prio"==e.features[0].properties.brand||"Prio"==e.features[0].properties.brand_management?s+='<div class="row"><div class="col-md"><b>AS DISPONIBILIDADES DAS BOMBAS DA PRIO</b></div></div><div class="row"><div class="col-md"><b>LISTADAS NESTE SITE ESTÃO A SER GERIDAS</b></div></div><div class="row"><div class="col-md"><b><a target="_blank" rel="noopener noreferrer" href="https://www.prio.pt/pt/">PELA PRÓPRIA PRIO</a></b></div></div>':"OZ Energia"==e.features[0].properties.brand||"OZ Energia"==e.features[0].properties.brand_management?s+='<div class="row"><div class="col-md"><b>AS DISPONIBILIDADES DAS BOMBAS DA OZ ENERGIA</b></div></div><div class="row"><div class="col-md"><b>LISTADAS NESTE SITE ESTÃO A SER GERIDAS</b></div></div><div class="row"><div class="col-md"><b><a target="_blank" rel="noopener noreferrer" href="https://www.ozenergia.pt/">PELA PRÓPRIA OZ ENERGIA</a></b></div></div>':"Ecobrent"==e.features[0].properties.brand||"Ecobrent"==e.features[0].properties.brand_management?s+='<div class="row"><div class="col-md"><b>AS DISPONIBILIDADES DAS BOMBAS DA ECOBRENT</b></div></div><div class="row"><div class="col-md"><b>LISTADAS NESTE SITE ESTÃO A SER GERIDAS</b></div></div><div class="row"><div class="col-md"><b><a target="_blank" rel="noopener noreferrer" href="https://www.ecobrent.pt/">PELA PRÓPRIA ECOBRENT</a></b></div></div>':"Bxpress"==e.features[0].properties.brand||"Bxpress"==e.features[0].properties.brand_management?s+='<div class="row"><div class="col-md"><b>AS DISPONIBILIDADES DAS BOMBAS DA BXPRESS</b></div></div><div class="row"><div class="col-md"><b>LISTADAS NESTE SITE ESTÃO A SER GERIDAS</b></div></div><div class="row"><div class="col-md"><b><a target="_blank" rel="noopener noreferrer" href="https://www.bongasenergias.pt/">PELA PRÓPRIA BXPRESS</a></b></div></div>':"Tfuel"==e.features[0].properties.brand||"Tfuel"==e.features[0].properties.brand_management?s+='<div class="row"><div class="col-md"><b>AS DISPONIBILIDADES DAS BOMBAS DA TFUEL</b></div></div><div class="row"><div class="col-md"><b>LISTADAS NESTE SITE ESTÃO A SER GERIDAS</b></div></div><div class="row"><div class="col-md"><b><a target="_blank" rel="noopener noreferrer" href="https://www.bongasenergias.pt/">PELA PRÓPRIA TFUEL</a></b></div></div>':s+=m?'<div class="row"><div class="col-md"><b>Localização Bloqueada</b></div></div><div class="row"><div class="col-md"><b>Por favor verifique as definições de privacidade do seu browser.</b></div></div>':'<div class="row"><div class="col-md"><b>POR FAVOR INDICA QUE COMBUSTÍVEIS ESTÃO OU NÃO ESTÃO</b></div></div><div class="row"><div class="col-md"><b>DISPONÍVEIS NA '+i+'.</b></div></div><div class="row"><div class="col-md"><b>CARREGA NAS IMAGENS.</b></div></div>',s+='</div><div class="v-popup-header" style="padding:0;background-color:#85d5f8"><div class="row" style="margin:0;"><div class="col-3"><a href="/error/edit?id='+e.features[0].properties.id+'"><img src="/img/map/VOSTPT_FUELCRISIS_REPORT_500pxX500px.png" style="height:2.5em;margin-top: 1.5vh;" /></a></div>',"Prio"==e.features[0].properties.brand?s+='<div class="col-9"><a target="_blank" rel="noopener noreferrer" href="https://www.prio.pt/pt/" style="margin:1.5vh"><h5  style="margin-right: 1.5vh;" class="popup_submit_text">PRIO</h5></a></div>':s+=m?'<div class="col-9" style="margin:1.5vh"></div>':'<div class="col-9"><a href="#" onclick="submitEntry(this,'+e.features[0].properties.id+')"  style="margin:1.5vh"><h5  style="margin-right: 1.5vh;" class="popup_submit_text">VALIDAR</h5></a></div>',s+="</div></div></div>";else{l="",e.features[0].properties.sell_gasoline&&(l+='<div class="col-md v-fuel-info">'+t+"<h6>GASOLINA</h6></div>"),e.features[0].properties.sell_diesel&&(l+='<div class="col-md v-fuel-info">'+a+"<h6>GASÓLEO</h6></div>"),e.features[0].properties.sell_lpg&&(l+='<div class="col-md v-fuel-info">'+r+"<h6>GPL</h6></div>");var n="";""!=e.features[0].properties.brand_management&&(n=" Entidade Gestora: "+e.features[0].properties.brand_management.toUpperCase()),s='<div class="v-popup-content"><div class="v-popup-header" style="background-color: #'+e.features[0].properties.popup_color+'"><h5>'+e.features[0].properties.brand.toUpperCase()+n+"<br><small>"+i+'</small></h5></div><div class="v-popup-body" style="background-color: #'+e.features[0].properties.background_color+'"><div class="row">'+l+'</div></div><div class="v-popup-body directions"><a href="https://www.waze.com/ul?ll='+o[1]+"%2C"+o[0]+'&navigate=yes&zoom=16&download_prompt=false"  target="_blank" rel="noopener noreferrer"><img src="/img/map/map_separation_'+e.features[0].properties.background_color+'.png" style="width: 100%;" /></a></div><div class="v-popup-header" style="padding:0;'+e.features[0].properties.popup_color+'"><div class="row" style="margin:0;"><div class="col-3"><a href="/error/edit?id='+e.features[0].properties.id+'"><img src="/img/map/VOSTPT_FUELCRISIS_REPORT_500pxX500px.png" style="height:2.5em;margin-top: 1.5vh;" /></a></div><div class="col-9"><a href="https://www.waze.com/ul?ll='+o[1]+"%2C"+o[0]+'&navigate=yes&zoom=16&download_prompt=false" style="margin:1.5vh"><h5 style="margin-right: 1.5vh;">OBTER DIREÇÕES</h5></a></div></div></div></div>'}for(;Math.abs(e.lngLat.lng-o[0])>180;)o[0]+=e.lngLat.lng>o[0]?360:-360;c.flyTo({center:[o[0],o[1]+.008],zoom:13}),null!=popup&&popup.isOpen()&&popup.remove(),popup=new mapboxgl.Popup({className:"mapboxgl-popup-info"}).setLngLat(o).setHTML(s).addTo(c),$('[data-toggle="tooltip"]').tooltip()});var o=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1,className:"mapboxgl-popup-tooltip"});c.on("mouseenter",e,function(e){c.getCanvas().style.cursor="pointer";for(var t=e.features[0].geometry.coordinates.slice(),a=e.features[0].properties.tooltip;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;o.setLngLat(t).setHTML(a).addTo(c)}),c.on("mouseleave",e,function(){c.getCanvas().style.cursor="",o.remove()})}(i)})})}),c.removeControl(s.obj),c.removeControl(i.obj),delete i.obj,i.obj=new mapboxgl.AttributionControl({compact:!0,customAttribution:b()}),c.addControl(i.obj),c.addControl(s.obj,"bottom-right"),_()})}function _(){var e=$("input.type[type=radio]:checked").val(),o=["normal","sos","none"],t=[],a=$('input[name="fuel_stations_brand[]"]:checked');0==a.length?d=!0:Object.values(a).forEach(function(e){var o=e.value;o&&t.push(o)}),n.forEach(function(a){l.forEach(function(r){p.forEach(function(i){var s="poi-"+a+"-"+r+"-"+i,l=o.includes(a),n=t.includes(i)||d,p=l&&(r==e||"all"==e)&&n;c.setLayoutProperty(s,"visibility",p?"visible":"none")})})})}c.on("load",function(){$(".mapboxgl-ctrl-logo").css("float","left"),$(".mapboxgl-ctrl-bottom-left .mapboxgl-ctrl").append('<a style="cursor: pointer;" target="_blank" rel="noopener nofollow"  href="https://twitter.com/vostpt"><img src="/img/VOSTPT_LETTERING_COLOR.png" style="height: 42px; margin-top: -15px; margin-left: 10px;"/></a>'),c.addControl(new MapboxGeocoder({accessToken:mapboxgl.accessToken,language:"pt-PT",mapboxgl:mapboxgl,marker:!1,filter:function(e){return e.context.map(function(e){return"country"===e.id.split(".").shift()&&"Portugal"===e.text}).reduce(function(e,o){return e||o})}})),a.push(f("REPA","/img/map/VOSTPT_JNDPA_REPA_ICON_25x25.png")),a.push(f("NONE","/img/map/VOSTPT_JNDPA_NONE_ICON_25x25.png")),a.push(f("PARTIAL","/img/map/VOSTPT_JNDPA_PARTIAL_ICON_25x25.png")),a.push(f("ALL","/img/map/VOSTPT_JNDPA_ALL_ICON_25x25.png")),a.push(f("REPA_PARTIAL","/img/map/VOSTPT_JNDPA_REPA_NORMAL_PARCIAL.png")),a.push(f("REPA_NONE","/img/map/VOSTPT_JNDPA_REPA_NORMAL_SEM.png")),a.push(f("SPAIN","/img/map/VOSTPT_JNDPA_ESPANHA_25px.png")),Promise.all(a).then(function(){a=[],h(!0);var e=findGetParameter("lat"),o=findGetParameter("long");null!=e&&null!=o?c.flyTo({center:[e,o],zoom:13}):navigator.geolocation?(console.log("Geolocation is supported!"),navigator.geolocation.getCurrentPosition(function(e){u=e.coords.latitude,g=e.coords.longitude,c.flyTo({center:[g,u],zoom:13})},function(e){console.log(e.message),m=!0,$(".alert-location-blocked").css("display","block").addClass("fade show")})):(console.log("Geolocation is not supported for this Browser/OS."),m=!0,$(".alert-location-blocked").css("display","block").addClass("fade show")),i.obj=new mapboxgl.AttributionControl({compact:!0,customAttribution:b()}),c.addControl(i.obj),s.obj=new mapboxgl.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}),c.addControl(s.obj,"bottom-right"),setInterval(h,3e4)})}),c.on("error",function(e){console.log("MAP LOAD ERROR"),console.log(e)}),$("input.type[type=radio]").change(function(){_()}),$('input[name="fuel_stations_brand[]"]').change(function(){d=!1,_()}),$("#a_reset_brand_filter").click(function(){d=!0,$('input[name="fuel_stations_brand[]"]').prop("checked",!1),_()})}});